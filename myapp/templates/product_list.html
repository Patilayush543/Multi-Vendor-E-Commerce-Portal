{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Products - Premium E-Commerce</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f1f4f;
            --secondary: #1a2d5a;
            --light: #f5f7fa;
            --text: #333;
            --border: #e0e0e0;
            --danger: #d32f2f;
        }
        body { background: #fff; color: var(--text); font-family: 'Segoe UI', sans-serif; }
        .nav-top { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); padding: 15px 0; position: sticky; top: 0; z-index: 100; }
        .nav-top a { color: white; text-decoration: none; font-weight: 500; }
        .container-wrapper { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
        .filters-section { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 30px; }
        .filter-title { font-weight: 700; color: var(--primary); margin-bottom: 15px; font-size: 18px; }
        .filter-group { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
        .filter-group:last-child { border-bottom: none; }
        .filter-input { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .product-card { background: white; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; transition: all 0.3s; }
        .product-card:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.1); transform: translateY(-5px); }
        .product-card-img { width: 100%; height: 220px; object-fit: cover; background: var(--light); }
        .product-card-body { padding: 15px; }
        .product-card-title { font-weight: 600; color: var(--text); margin-bottom: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .product-card-price { font-size: 18px; font-weight: 700; color: var(--danger); }
        .product-card-brand { font-size: 12px; color: #888; margin-bottom: 8px; }
        .sort-dropdown { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; }
        @media (max-width: 768px) { .products-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="nav-top">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <a href="{% url 'home' %}"><i class="fas fa-arrow-left"></i> Home</a>
            <div style="display: flex; gap: 20px;">
                <a href="{% url 'cart_view_new' %}"><i class="fas fa-shopping-cart"></i> Cart</a>
                <a href="{% url 'wishlist_view' %}"><i class="fas fa-heart"></i> Wishlist</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'customer_dashboard' %}"><i class="fas fa-user"></i> Account</a>
                {% else %}
                    <a href="{% url 'auth' %}"><i class="fas fa-user"></i> Login</a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="container-wrapper">
        <h1 style="font-size: 32px; font-weight: 700; color: var(--primary); margin-bottom: 30px;">
            <i class="fas fa-shopping-bags"></i> Browse Our Products
        </h1>
        
        <div style="display: grid; grid-template-columns: 250px 1fr; gap: 30px;">
            <!-- Filters Sidebar -->
            <div>
                <div class="filters-section">
                    <div class="filter-title">Search</div>
                    <form method="GET" style="margin-bottom: 20px;">
                        <input type="text" name="search" class="filter-input" placeholder="Search products..." value="{{ search_query }}">
                        <button type="submit" style="width: 100%; margin-top: 10px; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </form>
                </div>
                
                <div class="filters-section">
                    <div class="filter-title">Category</div>
                    <div class="filter-group">
                        <form method="GET">
                            <input type="hidden" name="search" value="{{ search_query }}">
                            {% for cat in categories %}
                            <div style="margin-bottom: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="category" value="{{ cat }}" {% if category == cat %}checked{% endif %} onchange="this.form.submit()" style="margin-right: 8px;">
                                    {{ cat|default:"All Categories" }}
                                </label>
                            </div>
                            {% endfor %}
                            <div style="margin-bottom: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="category" value="" {% if not category %}checked{% endif %} onchange="this.form.submit()" style="margin-right: 8px;">
                                    All Categories
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="filters-section">
                    <div class="filter-title">Price Range</div>
                    <form method="GET" style="display: flex; flex-direction: column; gap: 10px;">
                        <input type="hidden" name="search" value="{{ search_query }}">
                        <input type="hidden" name="category" value="{{ category }}">
                        <label style="font-weight: 600; font-size: 13px;">Min Price (₹)</label>
                        <input type="number" name="min_price" class="filter-input" placeholder="0" value="{{ min_price }}">
                        <label style="font-weight: 600; font-size: 13px;">Max Price (₹)</label>
                        <input type="number" name="max_price" class="filter-input" placeholder="100000" value="{{ max_price }}">
                        <button type="submit" style="width: 100%; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-filter"></i> Apply
                        </button>
                    </form>
                </div>
                
                <div class="filters-section">
                    <div class="filter-title">Availability</div>
                    <form method="GET">
                        <input type="hidden" name="search" value="{{ search_query }}">
                        <input type="hidden" name="category" value="{{ category }}">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" name="in_stock" value="on" {% if in_stock %}checked{% endif %} onchange="this.form.submit()" style="margin-right: 8px;">
                            In Stock Only
                        </label>
                    </form>
                </div>
            </div>
            
            <!-- Products Section -->
            <div>
                <!-- Top Bar -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <div style="color: #666;">
                        Showing <strong>{{ products|length }}</strong> products
                        {% if search_query %}
                            for "<strong>{{ search_query }}</strong>"
                        {% endif %}
                    </div>
                    <form method="GET" style="width: 200px;">
                        <input type="hidden" name="search" value="{{ search_query }}">
                        <input type="hidden" name="category" value="{{ category }}">
                        <select name="sort" class="sort-dropdown" onchange="this.form.submit()">
                            <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>Newest First</option>
                            <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                            <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                            <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>Top Rated</option>
                            <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>Most Reviews</option>
                        </select>
                    </form>
                </div>
                
                <!-- Products Grid -->
                {% if products %}
                <div class="products-grid">
                    {% for product in products %}
                    <a href="{% url 'product_detail_new' product.id %}" style="text-decoration: none; color: inherit;">
                        <div class="product-card">
                            <img src="{{ product.image_url }}" alt="{{ product.title }}" class="product-card-img">
                            <div class="product-card-body">
                                <div class="product-card-brand">{{ product.brand }}</div>
                                <div class="product-card-title">{{ product.title|truncatechars:30 }}</div>
                                <div class="product-card-price">₹{{ product.price }}</div>
                                <div style="font-size: 12px; color: #888; margin-top: 8px;">
                                    {% if product.in_stock %}
                                        <span style="color: #2ecc71;"><i class="fas fa-check-circle"></i> In Stock</span>
                                    {% else %}
                                        <span style="color: #d32f2f;"><i class="fas fa-times-circle"></i> Out of Stock</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <div style="text-align: center; padding: 60px 20px; color: #888;">
                    <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <p style="font-size: 18px; font-weight: 600;">No products found</p>
                    <p>Try adjusting your search or filter criteria</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>
