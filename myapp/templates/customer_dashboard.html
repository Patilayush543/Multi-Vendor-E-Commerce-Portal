{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Customer Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{ --navy:#0f1f4f; --navy-2:#1a2d5a; --white:#ffffff; --muted:#6b7280; }
        body{ font-family: 'Segoe UI', Tahoma, Arial, sans-serif; background:var(--navy-2); color:var(--navy-2); }
        .container-card{ max-width:1100px; margin:40px auto; background:var(--white); border-radius:12px; padding:24px; box-shadow:0 12px 30px rgba(15,31,79,0.08);} 
        .header{ display:flex; align-items:center; gap:16px; margin-bottom:18px; }
        .avatar{ width:72px; height:72px; border-radius:10px; background:linear-gradient(135deg,var(--navy),var(--navy-2)); color:var(--white); display:flex; align-items:center; justify-content:center; font-size:28px; }
        .stats{ display:flex; gap:12px; margin-top:14px; }
        .stat{ background:#f8fafc; padding:12px 16px; border-radius:8px; font-weight:600; }
        .orders{ margin-top:20px; }
        .order-row{ border-bottom:1px solid #eef2f7; padding:14px 0; display:flex; justify-content:space-between; align-items:center; }
        a.btn-primary-custom{ background:var(--navy); color:var(--white); padding:8px 14px; border-radius:8px; text-decoration:none; }
    </style>
</head>
<body>
    <div class="container-card">
        <div class="header">
            <div class="avatar">{{ user.first_name|default:user.username|first }}</div>
            <div>
                <h3 style="margin:0; color:var(--navy);">Hello, {{ user.first_name|default:user.username }}</h3>
                <div style="color:var(--muted); font-size:14px;">{{ profile.user_type|default:'Customer' }} • {{ user.email }}</div>
                <div class="stats">
                    <div class="stat">Orders: {{ total_orders }}</div>
                    <div class="stat">Spent: ₹{{ total_spent }}</div>
                    <div class="stat">Invoices: {{ invoices.count }}</div>
                </div>
            </div>
            <div class="ms-auto">
                <a class="btn-primary-custom" href="/profile/">Edit Profile</a>
            </div>
        </div>

        <div class="orders">
            <h5 style="color:var(--navy);">Recent Orders</h5>
            {% if recent_orders %}
                {% for o in recent_orders %}
                <div class="order-row">
                    <div>
                        <div style="font-weight:700;">Order #{{ o.id }}</div>
                        <div style="color:var(--muted); font-size:13px;">{{ o.ordered_date|date:'M d, Y' }} • {{ o.status|capfirst }}</div>
                    </div>
                    <div style="text-align:right;">
                            <div style="font-weight:700;">₹{{ o.total_price }}</div>
                            {% if o.product %}
                                <a href="{% url 'product_detail_new' o.product.id %}" class="btn btn-link">View</a>
                            {% else %}
                                <a href="{% url 'order_detail' o.id %}" class="btn btn-link">View</a>
                            {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="padding:24px; text-align:center; color:var(--muted);">No recent orders</div>
            {% endif %}
        </div>

        <div class="mt-4">
            <h5 style="color:var(--navy);">Invoices</h5>
            {% if invoices %}
                <ul>
                {% for inv in invoices %}
                    <li style="margin-bottom:8px;">{{ inv.invoice_number }} — ₹{{ inv.total }} — <a href="{% url 'download_invoice_consolidated' inv.id %}">Download</a></li>
                {% endfor %}
                </ul>
            {% else %}
                <div style="color:var(--muted);">No invoices</div>
            {% endif %}
        </div>
    </div>
</body>
</html>
